
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Secure Payment</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
    :root {
      --primary: #1976d2;
      --primary-dark: #0d47a1;
      --primary-light: #e3f2fd;
      --secondary: #4a4a4a;
      --success: #28a745;
      --danger: #dc3545;
      --warning: #ffc107;
      --text: #333333;
      --text-light: #666666;
      --border: #e0e0e0;
      --bg: #f8fafc;
      --card-bg: #ffffff;
      --shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
      --radius: 12px;
      --transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
    }
    
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: 'Poppins', sans-serif;
    }
    
    body {
      background-color: var(--bg);
      color: var(--text);
      line-height: 1.6;
    }
    
    /* Header */
    header {
      background: linear-gradient(135deg, var(--primary), var(--primary-dark));
      color: white;
      padding: 1rem 1.5rem;
      display: flex;
      justify-content: center;
      align-items: center;
      position: sticky;
      top: 0;
      z-index: 1000;
      box-shadow: var(--shadow);
      height: 70px;
    }
    
    .header-content {
      display: flex;
      justify-content: space-between;
      align-items: center;
      width: 100%;
      
      margin: 0 auto;
    }
    
    .logo {
      display: flex;
      align-items: center;
      gap: 0.8rem;
      font-weight: 600;
      font-size: 1.2rem;
    }
    
    #countdown {
      background-color: rgba(255, 255, 255, 0.2);
      padding: 0.5rem 0.8rem;
      border-radius: 50px;
      font-size: 0.9rem;
      display: flex;
      align-items: center;
      gap: 0.3rem;
    }
    
    /* Main Container */
    .main-container {
      width: 100%;
      max-width: 800px;
      margin: 2rem auto;
      padding: 0 1rem;
    }
    
    /* Progress Steps */
    .progress-steps {
      display: flex;
      justify-content: space-between;
      margin-bottom: 2rem;
      position: relative;
    }
    
    .progress-steps::before {
      content: '';
      position: absolute;
      top: 15px;
      left: 0;
      right: 0;
      height: 2px;
      background-color: var(--border);
      z-index: 1;
    }
    
    .step {
      display: flex;
      flex-direction: column;
      align-items: center;
      z-index: 2;
    }
    
    .step-number {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      background-color: var(--border);
      color: var(--text-light);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      margin-bottom: 0.5rem;
      position: relative;
    }
    
    .step.active .step-number {
      background-color: var(--primary);
      color: white;
    }
    
    .step.completed .step-number {
      background-color: var(--success);
      color: white;
    }
    
    .step.completed .step-number::after {
      content: '\f00c';
      font-family: 'Font Awesome 6 Free';
      font-weight: 900;
    }
    
    .step-label {
      font-size: 0.85rem;
      color: var(--text-light);
      text-align: center;
    }
    
    .step.active .step-label {
      color: var(--primary);
      font-weight: 500;
    }
    
    /* Payment Container */
    .payment-container {
      background-color: var(--card-bg);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow: hidden;
      margin-bottom: 1.5rem;
    }
    
    .section-header {
      padding: 1rem 1.5rem;
      background-color: var(--primary-light);
      border-bottom: 1px solid var(--border);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .section-title {
      font-size: 1.1rem;
      font-weight: 600;
      color: var(--primary);
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    
    .section-title i {
      font-size: 1.1rem;
    }
    
    .section-content {
      padding: 1.5rem;
    }
    
    /* Amount Card */
    .amount-card {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 1.5rem;
      background-color: var(--primary-light);
      border-radius: var(--radius);
      margin-bottom: 1.5rem;
    }
    
    .amount-label {
      font-size: 1rem;
      color: var(--text-light);
    }
    
    .amount-value {
      font-size: 1.8rem;
      font-weight: 700;
      color: var(--primary-dark);
    }
    
    /* Payment Methods */
    .payment-methods {
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }
    
    .payment-option {
      display: flex;
      align-items: center;
      padding: 1rem;
      border: 1px solid var(--border);
      border-radius: var(--radius);
      cursor: pointer;
      transition: var(--transition);
    }
    
    .payment-option:hover {
      border-color: var(--primary);
      background-color: var(--primary-light);
    }
    
    .payment-option.active {
      border-color: var(--primary);
      background-color: var(--primary-light);
    }
    
    .payment-option input[type="radio"] {
      margin-right: 1rem;
      accent-color: var(--primary);
      width: 18px;
      height: 18px;
    }
    
    .payment-details {
      flex: 1;
    }
    
    .payment-title {
      font-weight: 600;
      margin-bottom: 0.3rem;
    }
    
    .payment-description {
      font-size: 0.9rem;
      color: var(--text-light);
    }
    
    .payment-icon {
      margin-left: 1rem;
      font-size: 1.5rem;
      color: var(--primary);
    }
    
    /* UPI Apps Section */
    .upi-apps {
      display: flex;
      justify-content: center;
      gap: 1rem;
      margin-top: 1.5rem;
      flex-wrap: wrap;
    }
    
    .upi-app {
      display: flex;
      flex-direction: column;
      align-items: center;
      cursor: pointer;
      transition: var(--transition);
      padding: 0.5rem;
      border-radius: var(--radius);
    }
    
    .upi-app:hover {
      background-color: var(--primary-light);
    }
    
    .upi-app-icon {
      width: 50px;
      height: 50px;
      object-fit: contain;
      margin-bottom: 0.5rem;
    }
    
    .upi-app-name {
      font-size: 0.8rem;
      font-weight: 500;
      color: var(--text);
    }
    
    /* UPI Section */
    .upi-section {
      text-align: center;
      margin-top: 1rem;
      padding: 1rem;
      background-color: #f9f9f9;
      border-radius: var(--radius);
      border: 1px dashed var(--border);
    }
    
    .upi-image {
      max-width: 200px;
      width: 100%;
      height: auto;
      margin: 0 auto 1rem;
      display: block;
    }
    
    .upi-id {
      font-family: monospace;
      font-size: 1.1rem;
      font-weight: 600;
      color: var(--text);
      background-color: white;
      padding: 0.5rem 1rem;
      border-radius: 50px;
      display: inline-block;
      margin-bottom: 0.5rem;
    }
    
    .copy-btn {
      background-color: var(--primary);
      color: white;
      border: none;
      padding: 0.5rem 1rem;
      border-radius: 50px;
      font-size: 0.9rem;
      cursor: pointer;
      transition: var(--transition);
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
    }
    
    .copy-btn:hover {
      background-color: var(--primary-dark);
    }
    
    /* Address Section */
    .address-options {
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }
    
    .address-option {
      display: flex;
      align-items: flex-start;
      padding: 1rem;
      border: 1px solid var(--border);
      border-radius: var(--radius);
      cursor: pointer;
      transition: var(--transition);
    }
    
    .address-option:hover {
      border-color: var(--primary);
    }
    
    .address-option.active {
      border-color: var(--primary);
      background-color: var(--primary-light);
    }
    
    .address-option input[type="radio"] {
      margin-right: 1rem;
      margin-top: 0.3rem;
      accent-color: var(--primary);
    }
    
    .address-details {
      flex: 1;
    }
    
    .address-name {
      font-weight: 600;
      margin-bottom: 0.3rem;
    }
    
    .address-text {
      font-size: 0.95rem;
      color: var(--text);
      white-space: pre-line;
    }
    
    .add-address-btn {
      background-color: transparent;
      color: var(--primary);
      border: 1px dashed var(--primary);
      padding: 1rem;
      border-radius: var(--radius);
      width: 100%;
      font-weight: 500;
      cursor: pointer;
      transition: var(--transition);
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
    }
    
    .add-address-btn:hover {
      background-color: var(--primary-light);
    }
    
    /* Delivery Confirmation */
    .delivery-confirm {
      display: flex;
      align-items: center;
      margin-top: 1rem;
      padding: 1rem;
      background-color: var(--primary-light);
      border-radius: var(--radius);
    }
    
    .delivery-confirm input[type="checkbox"] {
      margin-right: 1rem;
      accent-color: var(--primary);
      width: 18px;
      height: 18px;
    }
    
    /* Action Buttons */
    .action-buttons {
      display: flex;
      gap: 1rem;
      margin-top: 2rem;
    }
    
    .btn {
      padding: 1rem 1.5rem;
      border: none;
      border-radius: var(--radius);
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: var(--transition);
      flex: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
    }
    
    .btn-primary {
      background-color: var(--primary);
      color: white;
    }
    
    .btn-primary:hover {
      background-color: var(--primary-dark);
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(25, 118, 210, 0.3);
    }
    
    .btn-secondary {
      background-color: white;
      color: var(--primary);
      border: 1px solid var(--primary);
    }
    
    .btn-secondary:hover {
      background-color: var(--primary-light);
    }
    
    /* OR Separator */
    .or-separator {
      display: flex;
      align-items: center;
      margin: 1.5rem 0;
      color: var(--text-light);
    }
    
    .or-separator::before,
    .or-separator::after {
      content: "";
      flex: 1;
      border-bottom: 1px solid var(--border);
    }
    
    .or-text {
      padding: 0 1rem;
      font-size: 0.9rem;
      font-weight: 500;
    }
    
    /* Popup */
    .popup-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: rgba(0, 0, 0, 0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 2000;
      opacity: 0;
      visibility: hidden;
      transition: var(--transition);
    }
    
    .popup-overlay.active {
      opacity: 1;
      visibility: visible;
    }
    
    .popup {
      background-color: white;
      border-radius: var(--radius);
      box-shadow: 0 8px 30px rgba(0, 0, 0, 0.2);
      width: 90%;
      max-width: 500px;
      transform: translateY(20px);
      transition: var(--transition);
      overflow: hidden;
    }
    
    .popup-overlay.active .popup {
      transform: translateY(0);
    }
    
    .popup-header {
      padding: 1rem 1.5rem;
      background-color: var(--primary);
      color: white;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .popup-title {
      font-size: 1.2rem;
      font-weight: 600;
    }
    
    .close-popup {
      font-size: 1.5rem;
      cursor: pointer;
      transition: var(--transition);
    }
    
    .close-popup:hover {
      opacity: 0.8;
    }
    
    .popup-body {
      padding: 1.5rem;
    }
    
    .form-group {
      margin-bottom: 1.2rem;
    }
    
    .form-label {
      display: block;
      margin-bottom: 0.5rem;
      font-weight: 500;
      color: var(--text);
    }
    
    .form-control {
      width: 100%;
      padding: 0.8rem 1rem;
      border: 1px solid var(--border);
      border-radius: var(--radius);
      font-size: 1rem;
      transition: var(--transition);
    }
    
    .form-control:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(25, 118, 210, 0.2);
    }
    
    textarea.form-control {
      min-height: 100px;
      resize: vertical;
    }
    
    .popup-footer {
      padding: 1rem 1.5rem;
      background-color: #f9f9f9;
      display: flex;
      justify-content: flex-end;
      gap: 1rem;
    }
    
    /* Success/Failure Screens */
    .result-screen {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: white;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      text-align: center;
      padding: 2rem;
      z-index: 3000;
      opacity: 0;
      visibility: hidden;
      transition: var(--transition);
    }
    
    .result-screen.active {
      opacity: 1;
      visibility: visible;
    }
    
    .result-icon {
      font-size: 4rem;
      margin-bottom: 1.5rem;
    }
    
    .success-icon {
      color: var(--success);
    }
    
    .failure-icon {
      color: var(--danger);
    }
    
    .result-title {
      font-size: 2rem;
      font-weight: 700;
      margin-bottom: 1rem;
      color: var(--text);
    }
    
    .success-title {
      color: var(--success);
    }
    
    .failure-title {
      color: var(--danger);
    }
    
    .result-message {
      font-size: 1.1rem;
      color: var(--text-light);
      margin-bottom: 2rem;
      max-width: 500px;
    }
    
    .order-details {
      background-color: var(--primary-light);
      padding: 1.5rem;
      border-radius: var(--radius);
      margin-bottom: 2rem;
      width: 100%;
      max-width: 400px;
    }
    
    .order-id {
      font-weight: 600;
      margin-bottom: 0.5rem;
    }
    
    .order-amount {
      font-size: 1.2rem;
      font-weight: 700;
      color: var(--primary-dark);
    }
    
    .btn-continue {
      background-color: var(--primary);
      color: white;
      padding: 1rem 2rem;
      border-radius: var(--radius);
      font-weight: 600;
      text-decoration: none;
      transition: var(--transition);
    }
    
    .btn-continue:hover {
      background-color: var(--primary-dark);
    }
    
    /* Emojis Animation */
    .emoji {
      position: fixed;
      font-size: 2rem;
      z-index: 9999;
      pointer-events: none;
      animation: fall 3s linear forwards;
    }
    
    @keyframes fall {
      0% {
        transform: translateY(0) rotate(0deg);
        opacity: 1;
      }
      100% {
        transform: translateY(100vh) rotate(720deg);
        opacity: 0;
      }
    }
    
    /* Responsive */
    @media (max-width: 768px) {
      .progress-steps {
        margin-bottom: 1.5rem;
      }
      
      .step-label {
        font-size: 0.75rem;
      }
      
      .amount-value {
        font-size: 1.5rem;
      }
      
      .action-buttons {
        flex-direction: column;
      }
      
      .btn {
        width: 100%;
      }
    }
    
    @media (max-width: 480px) {
      header {
        padding: 1rem;
      }
      
      .section-content {
        padding: 1rem;
      }
      
      .amount-card {
        flex-direction: column;
        align-items: flex-start;
        gap: 0.5rem;
      }
      
      .payment-option {
        flex-direction: column;
        align-items: flex-start;
      }
      
      .payment-icon {
        margin-left: 0;
        margin-top: 0.5rem;
        align-self: flex-end;
      }
    }
</style>
</head>
<body>
  <header>
    <div class="header-content">
     <div class="logo">
  <i class="fas fa-credit-card"></i>
  <span>Payment Options</span>
</div>
      <div id="countdown">
        <i class="fas fa-clock"></i>
        <span>05:00</span>
      </div>
    </div>
  </header>

  <div class="main-container">
    <!-- Progress Steps -->
    <div class="progress-steps">
      <div class="step completed">
        <div class="step-number">1</div>
        <div class="step-label">Cart</div>
      </div>
      <div class="step completed">
        <div class="step-number">2</div>
        <div class="step-label">Details</div>
      </div>
      <div class="step active">
        <div class="step-number">3</div>
        <div class="step-label">Payment</div>
      </div>
      <div class="step">
        <div class="step-number">4</div>
        <div class="step-label">Complete</div>
      </div>
    </div>

    <!-- Amount Card -->
    <div class="amount-card">
      <div class="amount-label">Total Amount</div>
      <div class="amount-value" id="payAmount">‚Çπ0</div>
    </div>

    <!-- Payment Methods -->
    <div class="payment-container">
      <div class="section-header">
        <div class="section-title">Payment Method</div>
      </div>
      <div class="section-content">
        <div class="payment-methods">
          <label class="payment-option active">
            <input type="radio" name="payment" value="upi" checked>
            <div class="payment-details">
              <div class="payment-title">UPI Payment</div>
              <div class="payment-description">Instant payment using any UPI app</div>
            </div>
            <i class="fas fa-mobile-alt payment-icon"></i>
          </label>
          
         <div id="upiSection" class="upi-section" style="display: none;">

            <!-- UPI Apps Section - NEW -->
            <div class="upi-apps">
              <div class="upi-app" onclick="payWithPhonePe()">
                <img src="phonepe.png" alt="PhonePe" class="upi-app-icon">
                <span class="upi-app-name">PhonePe</span>
              </div>
              <div class="upi-app" onclick="payWithPaytm()">
                <img src="https://pwebassets.paytm.com/commonwebassets/paytmweb/header/images/logo.svg" alt="Paytm" class="upi-app-icon">
                <span class="upi-app-name">Paytm</span>
              </div>
              <div class="upi-app" onclick="payWithGooglePay()">
                <img src="gpay.jpg" alt="Google Pay" class="upi-app-icon">
                <span class="upi-app-name">Google Pay</span>
              </div>
            </div>

            <div class="or-separator">
  <span class="or-text">OR</span>
</div>
            
            <img src="QR.png" alt="Scan QR Code" class="upi-image">
            <div class="upi-id">9739170288@ybl</div>
            <button class="copy-btn" onclick="copyUPI()">
              <i class="far fa-copy"></i> Copy UPI ID
            </button>
            <p style="margin-top: 1rem; font-size: 0.9rem; color: var(--text-light);">
              Scan the QR code or send payment to the UPI ID above
            </p>
          </div>
          
          <label class="payment-option">
            <input type="radio" name="payment" value="cod">
            <div class="payment-details">
              <div class="payment-title">Cash on Delivery</div>
              <div class="payment-description">Pay when you receive your order</div>
            </div>
            <i class="fas fa-money-bill-wave payment-icon"></i>
          </label>
        </div>
      </div>
    </div>

    <!-- Delivery Address -->
    <div class="payment-container">
      <div class="section-header">
        <div class="section-title">Delivery Address</div>
      </div>
      <div class="section-content">
        <div class="address-options" id="addressOptions">
          <label class="address-option active">
            <input type="radio" name="address" value="checkoutAddress" checked>
            <div class="address-details">
              <div class="address-name" id="checkoutName">Your Name</div>
              <div class="address-text" id="checkoutAddress">
                Your Address
              </div>
            </div>
          </label>
        </div>
        
        <button class="add-address-btn" onclick="togglePopup()">
          <i class="fas fa-plus"></i> Add New Address
        </button>
        
        <div class="delivery-confirm">
          <input type="checkbox" id="sameDelivery" checked>
          <label for="sameDelivery">Deliver to this address</label>
        </div>
      </div>
    </div>

    <!-- Action Buttons -->
    <div class="action-buttons">
      <button class="btn btn-secondary" onclick="window.history.back()">
        <i class="fas fa-arrow-left"></i> Back
      </button>
      <button class="btn btn-primary" onclick="placeOrder()">
        <i class="fas fa-lock"></i> Complete Payment
      </button>
    </div>
  </div>

  <!-- Add Address Popup -->
  <div class="popup-overlay" id="popupOverlay">
    <div class="popup">
      <div class="popup-header">
        <div class="popup-title">Add New Address</div>
        <div class="close-popup" onclick="closePopup()">&times;</div>
      </div>
      <div class="popup-body">
        <div class="form-group">
          <label class="form-label">Full Name</label>
          <input type="text" class="form-control" id="newName" placeholder="Enter your full name">
        </div>
        <div class="form-group">
          <label class="form-label">Mobile Number</label>
          <input type="text" class="form-control" id="newContact" placeholder="Enter 10-digit mobile number">
        </div>
        <div class="form-group">
          <label class="form-label">Full Address</label>
          <textarea class="form-control" id="newAddress" placeholder="House no, Building, Street, Area, City, State, Pincode"></textarea>
        </div>
      </div>
      <div class="popup-footer">
        <button class="btn btn-secondary" onclick="closePopup()">Cancel</button>
        <button class="btn btn-primary" onclick="saveNewAddress()">Save Address</button>
      </div>
    </div>
  </div>

<!-- Success Screen -->
<div class="result-screen" id="successScreen">
  <div class="result-icon success-icon">
    <i class="fas fa-check-circle"></i>
  </div>
  <h1 class="result-title success-title">Order Confirmed!</h1>
  <p class="result-message">Thank you for your order. We've sent a confirmation to your email.</p>
  
  <div class="order-details">
    <div class="order-id">Order ID: <span id="successOrderId"></span></div>
    <!-- This div will show for prepaid payments -->
    <div class="order-amount prepaid-amount">Amount Paid: <span id="successAmount"></span></div>
    <!-- This div will show for COD payments -->
    <div class="order-amount cod-amount" style="display: none;">
      <div>Amount to be Paid: <span id="codAmount"></span></div>
      <div>Advance Paid: <span id="advancePaid"></span></div>
    </div>
  </div>
  
  <a href="index.html" class="btn-continue">Continue Shopping</a>
</div>



  <!-- Failure Screen -->
  <div class="result-screen" id="failureScreen">
    <div class="result-icon failure-icon">
      <i class="fas fa-times-circle"></i>
    </div>
    <h1 class="result-title failure-title">Payment Failed</h1>
    <p class="result-message">We couldn't process your payment. Please try again or use a different payment method.</p>
    <button class="btn-continue" onclick="retryPayment()">Try Again</button>
  </div>

  <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
  <script>
    emailjs.init("yWquru6Fki6Lvx0je");
    
    // Initialize page
    document.addEventListener('DOMContentLoaded', function() {
      // Load checkout data
      const checkoutData = JSON.parse(localStorage.getItem('checkoutDetails')) || {};
      const checkoutItems = JSON.parse(localStorage.getItem('checkoutItem')) || [];
      
      // Set address
      if (checkoutData.name && checkoutData.currentAddress) {
        document.getElementById('checkoutName').textContent = checkoutData.name;
        document.getElementById('checkoutAddress').textContent = checkoutData.currentAddress;
      }
      
      // Calculate total amount
      calculateTotalAmount();
      
      // Start countdown on user interaction
      document.body.addEventListener('click', startCountdown, { once: true });
    });
    
    // Calculate total amount
    function calculateTotalAmount() {
      const checkoutItems = JSON.parse(localStorage.getItem('checkoutItem')) || [];
      let total = 0;
      
      checkoutItems.forEach(item => {
        const price = Number(item.price) || 0;
        const qty = Number(item.qty || item.quantity || 1);
        total += price * qty;
      });
      
      document.getElementById("payAmount").textContent = `‚Çπ${total.toLocaleString('en-IN')}`;
      return total;
    }
    
    // NEW: Payment with UPI Apps
    function payWithPhonePe() {
      const amount = calculateTotalAmount();
      const upiId = '9739170288@ybl';
      const note = `Payment for order`;
      
      // PhonePe UPI Deep Link
      const phonePeUrl = `phonepe://pay?pa=${upiId}&pn=MerchantName&am=${amount}&cu=INR&tn=${note}`;
      
      // Try to open PhonePe app
      window.location.href = phonePeUrl;
      
      // Fallback to website if app not installed
      setTimeout(() => {
        window.location.href = 'https://www.phonepe.com/';
      }, 500);
    }
    
    function payWithPaytm() {
      const amount = calculateTotalAmount();
      const upiId = '9739170288@ybl';
      const note = `Payment for order`;
      
      // Paytm UPI Deep Link
      const paytmUrl = `paytmmp://pay?pa=${upiId}&pn=MerchantName&am=${amount}&cu=INR&tn=${note}`;
      
      // Try to open Paytm app
      window.location.href = paytmUrl;
      
      // Fallback to website if app not installed
      setTimeout(() => {
        window.location.href = 'https://paytm.com/';
      }, 500);
    }
    
    function payWithGooglePay() {
      const amount = calculateTotalAmount();
      const upiId = '9739170288@ybl';
      const note = `Payment for order`;
      
      // Google Pay UPI Deep Link
      const googlePayUrl = `tez://upi/pay?pa=${upiId}&pn=MerchantName&am=${amount}&cu=INR&tn=${note}`;
      
      // Try to open Google Pay app
      window.location.href = googlePayUrl;
      
      // Fallback to website if app not installed
      setTimeout(() => {
        window.location.href = 'https://pay.google.com/';
      }, 500);
    }
    
    // Countdown timer
    let countdownInterval;
    let countdownTime = 300; // 5 minutes
    
    function startCountdown() {
      updateCountdownDisplay();
      countdownInterval = setInterval(updateCountdown, 1000);
    }
    
    function updateCountdown() {
      const minutes = Math.floor(countdownTime / 60);
      const seconds = countdownTime % 60;
      
      document.getElementById("countdown").innerHTML = `
        <i class="fas fa-clock"></i>
        <span>${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}</span>
      `;
      
      if (countdownTime <= 0) {
        clearInterval(countdownInterval);
        showSessionExpired();
      } else {
        countdownTime--;
      }
    }
    
    function updateCountdownDisplay() {
      const minutes = Math.floor(countdownTime / 60);
      const seconds = countdownTime % 60;
      document.getElementById("countdown").innerHTML = `
        <i class="fas fa-clock"></i>
        <span>${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}</span>
      `;
    }
    
    function showSessionExpired() {
      alert("Your session has expired. Please restart the checkout process.");
      window.location.href = "checkout.html";
    }
    
    // Address popup
    function togglePopup() {
      document.getElementById('popupOverlay').classList.toggle('active');
    }
    
    function closePopup() {
      document.getElementById('popupOverlay').classList.remove('active');
    }
    
    function saveNewAddress() {
      const name = document.getElementById('newName').value.trim();
      const contact = document.getElementById('newContact').value.trim();
      const address = document.getElementById('newAddress').value.trim();
      
      if (!name || !contact || !address) {
        alert("Please fill in all fields");
        return;
      }
      
      if (!/^\d{10}$/.test(contact)) {
        alert("Please enter a valid 10-digit mobile number");
        return;
      }
      
      const addressHTML = `
        <label class="address-option">
          <input type="radio" name="address" value="newAddress">
          <div class="address-details">
            <div class="address-name">${name}</div>
            <div class="address-text">${contact}\n${address}</div>
          </div>
        </label>
      `;
      
      document.getElementById('addressOptions').insertAdjacentHTML('beforeend', addressHTML);
      closePopup();
      
      // Clear form
      document.getElementById('newName').value = '';
      document.getElementById('newContact').value = '';
      document.getElementById('newAddress').value = '';
    }
    
    // Copy UPI ID
    function copyUPI() {
      const upiId = '9739170288@ybl';
      navigator.clipboard.writeText(upiId).then(() => {
        alert('UPI ID copied to clipboard!');
      }).catch(err => {
        console.error('Failed to copy UPI ID:', err);
        // Fallback for older browsers
        const textarea = document.createElement('textarea');
        textarea.value = upiId;
        document.body.appendChild(textarea);
        textarea.select();
        document.execCommand('copy');
        document.body.removeChild(textarea);
        alert('UPI ID copied to clipboard!');
      });
    }
    
    // Place order
    function placeOrder() {
      const paymentMethod = document.querySelector('input[name="payment"]:checked').value;
      const addressOption = document.querySelector('input[name="address"]:checked');
      const deliveryConfirmed = document.getElementById('sameDelivery').checked;
      
      if (!addressOption || !deliveryConfirmed) {
        alert("Please select and confirm a delivery address");
        return;
      }
      
      // Get address details
      let addressDetails;
      if (addressOption.value === 'checkoutAddress') {
        const name = document.getElementById('checkoutName').textContent;
        const address = document.getElementById('checkoutAddress').textContent;
        addressDetails = `${name}\n${address}`;
      } else {
        const addressDiv = addressOption.closest('.address-option').querySelector('.address-details');
        const name = addressDiv.querySelector('.address-name').textContent;
        const address = addressDiv.querySelector('.address-text').textContent;
        addressDetails = `${name}\n${address}`;
      }
      
      // Prepare order data
      const checkoutData = JSON.parse(localStorage.getItem('checkoutDetails')) || {};
      const orderItems = JSON.parse(localStorage.getItem('checkoutItem')) || [];
      const orderId = `ORD-${Date.now()}-${Math.floor(Math.random() * 1000)}`;
      const totalAmount = calculateTotalAmount();
      
      const order = {
        orderId,
        email: checkoutData.email || 'guest@example.com',
        date: new Date().toISOString(),
        estimatedDelivery: new Date(Date.now() + 6 * 24 * 60 * 60 * 1000).toDateString(),
        items: orderItems,
        paymentMethod: paymentMethod.toUpperCase(),
        deliveryAddress: addressDetails,
        totalAmount
      };
      
      // Build email content
// Build email content
let itemsHtml = orderItems.map(item => `
  <div style="display: flex; margin-bottom: 15px; border-bottom: 1px solid #eee; padding-bottom: 15px;">
    <div style="flex: 0 0 80px; margin-right: 15px;">
      <img src="${item.image || 'https://via.placeholder.com/80'}" alt="${item.name}" style="width: 80px; height: 80px; object-fit: contain;">
    </div>
    <div style="flex: 1;">
      <h3 style="margin: 0 0 5px 0; font-size: 16px;">${item.name}</h3>
      <p style="margin: 0; color: #666;">Quantity: ${item.qty || 1}</p>
      <p style="margin: 5px 0 0 0; font-weight: bold;">‚Çπ${(item.price * (item.qty || 1)).toLocaleString('en-IN')}</p>
    </div>
  </div>
`).join('');

let emailMessage = `
  <div style="max-width: 600px; margin: 0 auto; font-family: Arial, sans-serif; color: #333;">
    <div style="text-align: center; margin-bottom: 20px;">
      <h1 style="color: #0b4127; margin-bottom: 5px;">Order Confirmation</h1>
      <p style="margin: 0;">Thank you for shopping with Mahaveer Enterprises!</p>
    </div>
    
    <div style="background-color: #f9f9f9; padding: 15px; border-radius: 4px; margin-bottom: 20px;">
      <p style="margin: 0 0 5px 0;"><strong>Order #:</strong> ${orderId}</p>
      <p style="margin: 0 0 5px 0;"><strong>Order Date:</strong> ${new Date(order.date).toDateString()}</p>
      <p style="margin: 0;"><strong>Estimated Delivery:</strong> ${order.estimatedDelivery}</p>
    </div>
    
    <h2 style="font-size: 18px; border-bottom: 1px solid #eee; padding-bottom: 5px; margin-bottom: 15px;">Your Items</h2>
    ${itemsHtml}
    
    <div style="margin: 20px 0;">
      <h2 style="font-size: 18px; border-bottom: 1px solid #eee; padding-bottom: 5px; margin-bottom: 10px;">Delivery Address</h2>
      <p style="margin: 0; white-space: pre-line;">${addressDetails}</p>
    </div>
    
    <div style="margin-bottom: 20px;">
      <h2 style="font-size: 18px; border-bottom: 1px solid #eee; padding-bottom: 5px; margin-bottom: 10px;">Payment Method</h2>
      <p style="margin: 0;">${paymentMethod === 'upi' ? 'UPI Payment' : 'Cash on Delivery'}</p>
    </div>
    
    <div style="background-color: #f9f9f9; padding: 15px; border-radius: 4px; text-align: right;">
      <p style="margin: 0; font-size: 18px; font-weight: bold;">
        Order Total: ‚Çπ${totalAmount.toLocaleString('en-IN')}
      </p>
    </div>
    
    <div style="text-align: center; margin-top: 30px; color: #666; font-size: 14px;">
      <p>Thank you for your purchase! We'll notify you when your order ships.</p>
    </div>
  </div>
`;
      
      // Send email
      emailjs.send("service_v1avwdt", "template_0pm6m3o", {
        email: order.email,
        order_id: orderId,
        order_date: new Date(order.date).toDateString(),
        delivery_date: order.estimatedDelivery,
        payment_mode: order.paymentMethod,
        delivery_address: order.deliveryAddress,
        total_amount: totalAmount,
        user_name: checkoutData.name || "Guest",
        message_html: emailMessage
      }).then(() => {
        console.log("Email sent successfully");
      }).catch(err => {
        console.error("Email sending failed:", err);
      });
      
      // Save order to localStorage
      let orders = JSON.parse(localStorage.getItem('orders')) || [];
      orders.push(order);
      localStorage.setItem('orders', JSON.stringify(orders));
      localStorage.setItem('lastOrderId', orderId);
      
      // Clear cart
      localStorage.removeItem('cart');
      localStorage.removeItem('isBuyNow');
      
      // Show success screen
      showSuccessScreen(orderId, totalAmount);
      
      // Celebration animation
      createEmojiCelebration();
    }
    
   function showSuccessScreen(orderId, amount) {
  const paymentMethod = document.querySelector('input[name="payment"]:checked').value;
  const successScreen = document.getElementById('successScreen');
  
  // Update common elements
  document.getElementById('successOrderId').textContent = orderId;
  
  if (paymentMethod === 'cod') {
    // For COD orders
    document.querySelector('.prepaid-amount').style.display = 'none';
    document.querySelector('.cod-amount').style.display = 'block';
    document.getElementById('codAmount').textContent = `‚Çπ${amount.toLocaleString('en-IN')}`;
    document.getElementById('advancePaid').textContent = '‚Çπ0';
    
    // Update the title and message for COD
    successScreen.querySelector('.result-title').textContent = 'Order Placed Successfully!';
    successScreen.querySelector('.result-message').textContent = 'Thank you for your order. Pay when you receive it. We\'ve sent a confirmation to your email.';
  } else {
    // For prepaid orders
    document.querySelector('.prepaid-amount').style.display = 'block';
    document.querySelector('.cod-amount').style.display = 'none';
    document.getElementById('successAmount').textContent = `‚Çπ${amount.toLocaleString('en-IN')}`;
    
    // Keep the original title and message for prepaid
    successScreen.querySelector('.result-title').textContent = 'Payment Successful!';
    successScreen.querySelector('.result-message').textContent = 'Thank you for your order. We\'ve sent a confirmation to your email.';
  }
  
  successScreen.classList.add('active');
  
  // Auto-redirect after 10 seconds
  setTimeout(() => {
    window.location.href = 'index.html';
  }, 10000);
}
    
    function createEmojiCelebration() {
      const emojis = ['üéâ', 'üéä', '‚ú®', 'üí•', 'üéà', 'ü•≥', 'üëç', 'üëè', 'üíØ'];
      
      for (let i = 0; i < 40; i++) {
        const emoji = document.createElement('div');
        emoji.className = 'emoji';
        emoji.textContent = emojis[Math.floor(Math.random() * emojis.length)];
        emoji.style.left = `${Math.random() * 100}vw`;
        emoji.style.top = `-${Math.random() * 20}vh`;
        emoji.style.animation = `fall ${3 + Math.random() * 2}s linear forwards`;
        emoji.style.animationDelay = `${Math.random() * 0.5}s`;
        document.body.appendChild(emoji);
        
        // Remove emoji after animation completes
        setTimeout(() => {
          emoji.remove();
        }, 5000);
      }
    }
    
    function retryPayment() {
      document.getElementById('failureScreen').classList.remove('active');
    }
    
    // Detect page refresh (payment failed)
    if (performance.navigation.type === 1) {
      showFailureScreen();
    }
    
    function showFailureScreen() {
      document.getElementById('failureScreen').classList.add('active');
      setTimeout(() => {
        window.location.href = "checkout.html";
      }, 3000);
    }
    
    // Handle page visibility changes
    document.addEventListener('visibilitychange', function() {
      if (document.visibilityState === 'hidden') {
        // Page is being hidden (possibly refreshed)
        showFailureScreen();
      }
    });

     document.addEventListener("DOMContentLoaded", function () {
    const deliveryDetails = JSON.parse(localStorage.getItem("deliveryDetails")) || {};

    document.getElementById("checkoutName").textContent =
      deliveryDetails.name || "Name not found";

    document.getElementById("checkoutAddress").textContent =
      deliveryDetails.address
        ? `${deliveryDetails.address}, ${deliveryDetails.city}, ${deliveryDetails.state} - ${deliveryDetails.zip}`
        : "Address not found";
  });



  document.addEventListener('DOMContentLoaded', function () {
  const paymentRadios = document.querySelectorAll('input[name="payment"]');
  const upiSection = document.getElementById('upiSection');

  // Initial display check
  toggleUPISection();

  // Add event listener to all radio buttons
  paymentRadios.forEach(radio => {
    radio.addEventListener('change', toggleUPISection);
  });

  function toggleUPISection() {
    const selected = document.querySelector('input[name="payment"]:checked').value;
    if (selected === 'upi') {
      upiSection.style.display = 'block';
    } else {
      upiSection.style.display = 'none';
    }
  }
});

  </script>
</body>
</html>