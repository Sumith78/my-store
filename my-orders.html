<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>My Orders | Mahaveer Enterprises</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
  <style>
    :root {
      --primary: #1976d2;
      --primary-dark: #0d47a1;
      --primary-light: #e3f2fd;
      --success: #28a745;
      --success-light: #e6f6ec;
      --danger: #dc3545;
      --danger-light: #fdecec;
      --warning: #ffc107;
      --warning-light: #fff8e1;
      --text: #333333;
      --text-light: #666666;
      --border: #e0e0e0;
      --bg: #f8fafc;
      --card-bg: #ffffff;
      --shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
      --radius: 12px;
    }
    
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: 'Poppins', sans-serif;
    }
    
    body {
      background-color: var(--bg);
      color: var(--text);
      line-height: 1.6;
    }
    
    /* Header */
    .orders-header {
      background: linear-gradient(to right, var(--primary), var(--primary-dark));
      color: white;
      padding: 1rem 1.5rem;
      display: flex;
      justify-content: center;
      align-items: center;
      position: sticky;
      top: 0;
      z-index: 1000;
      box-shadow: var(--shadow);
    }
    
    .header-title {
      font-weight: 600;
      font-size: 1.2rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    
    .back-btn {
      position: absolute;
      left: 1rem;
      background: none;
      border: none;
      color: white;
      font-size: 1.2rem;
      cursor: pointer;
    }
    
    /* Main Container */
    .orders-container {
      max-width: 800px;
      margin: 0 auto;
      padding: 5rem 1rem 2rem;
    }
    
    /* Order Cards */
    .order-card {
      background-color: var(--card-bg);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow: hidden;
      margin-bottom: 1.5rem;
      transition: transform 0.2s ease;
    }
    
    .order-card:hover {
      transform: translateY(-2px);
    }
    
    .order-header {
      padding: 1rem 1.5rem;
      border-bottom: 1px solid var(--border);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .order-id {
      font-weight: 500;
      color: var(--text-light);
      font-size: 0.9rem;
    }
    
    .order-date {
      font-weight: 500;
      color: var(--text);
    }
    
    .order-status {
      font-size: 0.8rem;
      font-weight: 600;
      padding: 4px 10px;
      border-radius: 20px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    
    .status-placed {
      background-color: var(--success-light);
      color: var(--success);
    }
    
    .status-delivered {
      background-color: var(--primary-light);
      color: var(--primary-dark);
    }
    
    .status-canceled {
      background-color: var(--danger-light);
      color: var(--danger);
    }
    
    .status-shipped {
      background-color: var(--warning-light);
      color: #ff9800;
    }
    
    .order-body {
      padding: 1.5rem;
    }
    
    .order-items {
      display: flex;
      flex-direction: column;
      gap: 1rem;
      margin-bottom: 1.5rem;
    }
    
    .order-item {
      display: flex;
      gap: 1rem;
      align-items: center;
    }
    
    .item-image {
      width: 70px;
      height: 70px;
      border-radius: 8px;
      object-fit: cover;
      border: 1px solid var(--border);
    }
    
    .item-details {
      flex: 1;
    }
    
    .item-name {
      font-weight: 500;
      margin-bottom: 0.25rem;
      color: var(--text);
    }
    
    .item-price {
      font-weight: 600;
      color: var(--text);
    }
    
    .item-quantity {
      font-size: 0.9rem;
      color: var(--text-light);
    }
    
    .order-summary {
      display: flex;
      justify-content: space-between;
      padding: 1rem 0;
      border-top: 1px dashed var(--border);
      border-bottom: 1px dashed var(--border);
      margin: 1.5rem 0;
    }
    
    .summary-label {
      font-weight: 500;
      color: var(--text-light);
    }
    
    .summary-value {
      font-weight: 600;
    }
    
    .order-actions {
      display: flex;
      gap: 1rem;
      margin-top: 1rem;
    }
    
    .action-btn {
      flex: 1;
      padding: 0.8rem;
      border-radius: var(--radius);
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s ease;
      text-align: center;
      font-size: 0.9rem;
      border: none;
    }
    
    .btn-primary {
      background-color: var(--primary);
      color: white;
    }
    
    .btn-primary:hover {
      background-color: var(--primary-dark);
    }
    
    .btn-outline {
      background-color: transparent;
      color: var(--primary);
      border: 1px solid var(--primary);
    }
    
    .btn-outline:hover {
      background-color: var(--primary-light);
    }
    
    /* Review Section */
    .review-section {
      margin-top: 1.5rem;
      padding-top: 1rem;
      border-top: 1px solid var(--border);
    }
    
    .review-title {
      font-weight: 500;
      margin-bottom: 0.5rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    
    .review-stars {
      color: var(--warning);
      margin-bottom: 0.5rem;
    }
    
    .review-text {
      font-size: 0.9rem;
      line-height: 1.5;
      color: var(--text);
      background-color: #f9f9f9;
      padding: 0.8rem;
      border-radius: 8px;
    }
    
    .write-review-btn {
      margin-top: 0.5rem;
      background-color: var(--warning);
      color: #000;
      border: none;
      padding: 0.5rem 1rem;
      border-radius: var(--radius);
      cursor: pointer;
      font-weight: 500;
      font-size: 0.9rem;
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
    }
    
    .write-review-btn:hover {
      background-color: #e0a800;
    }
    
    /* Empty State */
    .empty-orders {
      text-align: center;
      padding: 3rem 1rem;
    }
    
    .empty-icon {
      font-size: 3rem;
      color: var(--text-light);
      margin-bottom: 1rem;
    }
    
    .empty-title {
      font-weight: 500;
      margin-bottom: 0.5rem;
      color: var(--text);
    }
    
    .empty-text {
      color: var(--text-light);
      margin-bottom: 1.5rem;
    }
    
    .shop-btn {
      background-color: var(--primary);
      color: white;
      border: none;
      border-radius: var(--radius);
      padding: 0.8rem 1.5rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    
    .shop-btn:hover {
      background-color: var(--primary-dark);
    }
    
    /* Filter Tabs */
    .order-tabs {
      display: flex;
      border-bottom: 1px solid var(--border);
      margin-bottom: 1.5rem;
    }
    
    .order-tab {
      padding: 0.8rem 1.5rem;
      font-weight: 500;
      cursor: pointer;
      color: var(--text-light);
      position: relative;
      transition: all 0.2s ease;
    }
    
    .order-tab.active {
      color: var(--primary);
    }
    
    .order-tab.active::after {
      content: '';
      position: absolute;
      bottom: -1px;
      left: 0;
      right: 0;
      height: 2px;
      background-color: var(--primary);
    }
    
    /* Responsive */
    @media (max-width: 768px) {
      .orders-container {
        padding: 4.5rem 1rem 1rem;
      }
      
      .order-actions {
        flex-direction: column;
      }
    }
    
    @media (max-width: 480px) {
      .order-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 0.5rem;
      }
      
      .order-tabs {
        overflow-x: auto;
        padding-bottom: 5px;
      }
      
      .order-tabs::-webkit-scrollbar {
        height: 3px;
      }
      
      .order-tabs::-webkit-scrollbar-thumb {
        background-color: var(--primary);
      }
    }
  </style>
</head>
<body>

<header class="orders-header">
  <button class="back-btn" onclick="history.back()">
    <i class="fas fa-arrow-left"></i>
  </button>
  <div class="header-title">
    <i class="fas fa-clipboard-list"></i>
    My Orders
  </div>
</header>

<div class="orders-container">
  <div class="order-tabs">
    <div class="order-tab active" onclick="filterOrders('all')">All Orders</div>
    <div class="order-tab" onclick="filterOrders('active')">Active</div>
    <div class="order-tab" onclick="filterOrders('delivered')">Delivered</div>
    <div class="order-tab" onclick="filterOrders('cancelled')">Cancelled</div>
  </div>
  
  <div id="ordersList"></div>
  
  <div id="emptyState" class="empty-orders" style="display: none;">
    <div class="empty-icon">
      <i class="fas fa-clipboard"></i>
    </div>
    <h3 class="empty-title">No Orders Yet</h3>
    <p class="empty-text">You haven't placed any orders yet. Start shopping to see your orders here.</p>
    <button class="shop-btn" onclick="window.location.href='index.html'">
      <i class="fas fa-shopping-bag"></i> Start Shopping
    </button>
  </div>
</div>

<script>
// Generate a formatted order ID
function generateOrderId() {
  const timestamp = Date.now().toString();
  const randomNum = Math.floor(Math.random() * 10000).toString().padStart(4, '0');
  return `ORD-${timestamp.slice(-6)}-${randomNum}`;
}

// Load orders for logged-in user
function loadUserOrders() {
  // Get user email from localStorage (from your auth system)
  const userEmail = localStorage.getItem('user_email') || 
                   JSON.parse(localStorage.getItem('userData'))?.email ||
                   JSON.parse(localStorage.getItem('checkoutDetails'))?.email;
  
  if (!userEmail) {
    // Redirect to login if no user email found
    window.location.href = 'auth.html';
    return;
  }

  // Load all orders from localStorage
  const allOrders = JSON.parse(localStorage.getItem('orders')) || [];
  
  // Ensure each order has a properly formatted ID
  const ordersWithFormattedIds = allOrders.map(order => {
    if (!order.id || !order.id.startsWith('ORD-')) {
      return {
        ...order,
        id: generateOrderId()
      };
    }
    return order;
  });
  
  // Save back to localStorage if we updated any IDs
  if (ordersWithFormattedIds.length !== allOrders.length) {
    localStorage.setItem('orders', JSON.stringify(ordersWithFormattedIds));
  }
  
  // Filter orders for current user and sort by date (newest first)
  const userOrders = ordersWithFormattedIds
    .filter(order => order.email === userEmail)
    .sort((a, b) => new Date(b.date) - new Date(a.date));
  
  return userOrders;
}

// Render orders based on current filter
function renderOrders(filter = 'all') {
  const orders = loadUserOrders();
  const container = document.getElementById('ordersList');
  const emptyState = document.getElementById('emptyState');
  
  // Filter orders
  let filteredOrders = [];
  switch(filter) {
    case 'active':
      filteredOrders = orders.filter(o => !o.cancelled && o.status !== 'delivered');
      break;
    case 'delivered':
      filteredOrders = orders.filter(o => o.status === 'delivered');
      break;
    case 'cancelled':
      filteredOrders = orders.filter(o => o.cancelled || o.status === 'cancelled');
      break;
    default:
      filteredOrders = [...orders];
  }
  
  if (filteredOrders.length === 0) {
    container.innerHTML = '';
    emptyState.style.display = 'block';
    return;
  }
  
  emptyState.style.display = 'none';
  
  container.innerHTML = filteredOrders.map(order => {
    const orderDate = new Date(order.date).toLocaleDateString('en-IN', {
      day: 'numeric',
      month: 'short',
      year: 'numeric',
      hour: '2-digit',
      minute: '2-digit'
    });
    
    // Determine status
    let statusText, statusClass;
    if (order.cancelled) {
      statusText = 'CANCELLED';
      statusClass = 'status-canceled';
    } else {
      switch(order.status) {
        case 'placed': 
          statusText = 'ORDER PLACED';
          statusClass = 'status-placed';
          break;
        case 'shipped':
          statusText = 'SHIPPED';
          statusClass = 'status-shipped';
          break;
        case 'delivered':
          statusText = 'DELIVERED';
          statusClass = 'status-delivered';
          break;
        default:
          statusText = 'PROCESSING';
          statusClass = 'status-placed';
      }
    }
    
    // Calculate total amount
    const totalAmount = order.items.reduce((sum, item) => sum + (item.price * (item.quantity || 1)), 0);
    
    return `
      <div class="order-card">
        <div class="order-header">
          <div>
            <div class="order-id">Order #${order.id || generateOrderId()}</div>
            <div class="order-date">${orderDate}</div>
          </div>
          <div class="order-status ${statusClass}">${statusText}</div>
        </div>
        
        <div class="order-body">
          <div class="order-items">
            ${order.items.map(item => `
              <div class="order-item">
                <img src="${item.image || 'default-product.jpg'}" alt="${item.name}" class="item-image">
                <div class="item-details">
                  <div class="item-name">${item.name}</div>
                  <div class="item-price">₹${item.price.toLocaleString('en-IN')}</div>
                  <div class="item-quantity">Qty: ${item.quantity || 1}</div>
                </div>
              </div>
            `).join('')}
          </div>
          
          <div class="order-summary">
            <div class="summary-label">Total Amount:</div>
            <div class="summary-value">₹${totalAmount.toLocaleString('en-IN')}</div>
          </div>
          
          <div class="order-actions">
            <button class="action-btn btn-outline" onclick="window.location.href='order-details.html?orderId=${order.id}'">
              <i class="fas fa-file-alt"></i> View Details
            </button>
            ${!order.cancelled && order.status !== 'delivered' ? `
              <button class="action-btn btn-primary" onclick="window.location.href='track-order.html?orderId=${order.id}'">
                <i class="fas fa-truck"></i> Track Order
              </button>
            ` : ''}
          </div>
        </div>
      </div>
    `;
  }).join('');
}

// Filter orders when tab is clicked
function filterOrders(filter) {
  // Update active tab UI
  document.querySelectorAll('.order-tab').forEach(tab => {
    tab.classList.remove('active');
  });
  event.target.classList.add('active');
  
  // Render filtered orders
  renderOrders(filter);
}

// Initialize page
document.addEventListener('DOMContentLoaded', function() {
  renderOrders('all');
});
</script>

</body>
</html>